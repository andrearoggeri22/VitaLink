
<!doctype html>
<html lang="it" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation of VitaLink API">
      
      
        <meta name="author" content="Andrea Roggeri">
      
      
      
        <link rel="prev" href="observations.html">
      
      
        <link rel="next" href="utils.html">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Reports - VitaLink Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#app.reports" class="md-skip">
          Vai al contenuto
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Intestazione">
    <a href="../index.html" title="VitaLink Documentation" class="md-header__button md-logo" aria-label="VitaLink Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            VitaLink Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reports
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Cancella" aria-label="Cancella" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inizializza la ricerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/andrearoggeri22/VitaLink" title="Apri repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    VitaLink
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="api.html" class="md-tabs__link">
          
  
  
  Modules

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigazione" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="VitaLink Documentation" class="md-nav__button md-logo" aria-label="VitaLink Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    VitaLink Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/andrearoggeri22/VitaLink" title="Apri repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    VitaLink
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="api.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="app.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    App
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="audit.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Audit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="auth.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Auth
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="compile_translations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compile Translations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="email_utils.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Email Utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="health_platforms.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Health Platforms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="health_platforms_config.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Health Platforms Config
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="language.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Language
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="main.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Main
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="migrate.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migrate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="models.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="observations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Observations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Reports
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="reports.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Reports
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Indice">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Indice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#app.reports" class="md-nav__link">
    <span class="md-ellipsis">
      reports
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.reports.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.reports.PERIOD_DAYS" class="md-nav__link">
    <span class="md-ellipsis">
      PERIOD_DAYS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.reports.create_vital_chart" class="md-nav__link">
    <span class="md-ellipsis">
      create_vital_chart
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.reports.generate_specific_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_specific_report
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="utils.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="views.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Views
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Indice">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Indice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#app.reports" class="md-nav__link">
    <span class="md-ellipsis">
      reports
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.reports.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.reports.PERIOD_DAYS" class="md-nav__link">
    <span class="md-ellipsis">
      PERIOD_DAYS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.reports.create_vital_chart" class="md-nav__link">
    <span class="md-ellipsis">
      create_vital_chart
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.reports.generate_specific_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_specific_report
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Reports</h1>

<div class="doc doc-object doc-module">



<a id="app.reports"></a>
    <div class="doc doc-contents first">

        <p>Reports Generation Module.
This module provides functionality for generating patient health reports in various
formats (PDF, CSV, etc.). It includes:
1. Functions to create graphical charts for vital signs visualization
2. Data processing utilities to prepare and format health data for reporting
3. PDF generation with ReportLab for comprehensive patient reports
4. CSV export functionality for data analysis
Reports can include multiple vital signs, observations, and trends over configurable
time periods, providing healthcare professionals with valuable insights.</p>









  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="app.reports.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#app.reports.logger" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Mapping of period codes to their duration in days.
This dictionary defines the number of days that each period identifier represents,
used for calculating date ranges when generating reports and charts.
Keys:
    '1d': One day
    '7d': One week (7 days)
    '1m': One month (approximated as 30 days)
    '3m': Three months (approximated as 90 days)
    '1y': One year (approximated as 365 days)</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="app.reports.PERIOD_DAYS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">PERIOD_DAYS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1d&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;7d&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;1m&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;3m&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;1y&#39;</span><span class="p">:</span> <span class="mi">365</span><span class="p">}</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#app.reports.PERIOD_DAYS" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="app.reports.create_vital_chart" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_vital_chart</span><span class="p">(</span><span class="n">vitals_data</span><span class="p">,</span> <span class="n">period_name</span><span class="p">,</span> <span class="n">vital_type</span><span class="p">)</span></code>

<a href="#app.reports.create_vital_chart" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a chart drawing for a specific vital sign and time period.
This function generates a professionally styled line chart visualization for vital sign data
over a specified time period. It handles data sorting, formatting, and limiting the number
of data points to ensure readability. The function applies appropriate styling based on the
vital sign type including specific colors and formatting.
Args:
    vitals_data (list): List of dictionaries containing vital sign data points.
        Each dictionary must have at least 'value' and 'timestamp' keys.
    period_name (str): Name of the time period for the chart title (e.g. "Last 7 days").
    vital_type (str): Type of vital sign from VitalSignType enum values (e.g. "heart_rate").
Returns:
    Drawing: ReportLab Drawing object containing the styled chart ready to be
            included in a PDF document.</p>


            <details class="quote">
              <summary>Source code in <code>app/reports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_vital_chart</span><span class="p">(</span><span class="n">vitals_data</span><span class="p">,</span> <span class="n">period_name</span><span class="p">,</span> <span class="n">vital_type</span><span class="p">):</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    Create a chart drawing for a specific vital sign and time period.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    This function generates a professionally styled line chart visualization for vital sign data</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    over a specified time period. It handles data sorting, formatting, and limiting the number</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    of data points to ensure readability. The function applies appropriate styling based on the</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    vital sign type including specific colors and formatting.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        vitals_data (list): List of dictionaries containing vital sign data points.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            Each dictionary must have at least &#39;value&#39; and &#39;timestamp&#39; keys.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        period_name (str): Name of the time period for the chart title (e.g. &quot;Last 7 days&quot;).</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        vital_type (str): Type of vital sign from VitalSignType enum values (e.g. &quot;heart_rate&quot;).</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        Drawing: ReportLab Drawing object containing the styled chart ready to be</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">                included in a PDF document.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="c1"># Sort data by timestamp</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">sorted_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">vitals_data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="c1"># Extract values and dates for chart</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_data</span><span class="p">]</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_data</span><span class="p">]</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="c1"># Format dates for display</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">timestamps</span><span class="p">:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="k">if</span> <span class="n">ts</span><span class="p">:</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>                <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>                <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m&#39;</span><span class="p">))</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>                <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="c1"># Limit number of data points to make chart readable</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="n">max_points</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_points</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="n">step</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">//</span> <span class="n">max_points</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[::</span><span class="n">step</span><span class="p">]</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">dates</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[::</span><span class="n">step</span><span class="p">]</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="c1"># Create drawing and chart</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">drawing</span> <span class="o">=</span> <span class="n">Drawing</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">220</span><span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>      <span class="c1"># Define chart colors based on vital type</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">chart_colors</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="s1">&#39;heart_rate&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">red</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="s1">&#39;oxygen_saturation&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">blue</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="s1">&#39;breathing_rate&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">cyan</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">green</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="s1">&#39;temperature_core&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">orange</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="s1">&#39;temperature_skin&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">orange</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="s1">&#39;steps&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">teal</span><span class="p">,</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="s1">&#39;calories&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">orange</span><span class="p">,</span>  <span class="c1"># &lt;-- ADDED</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="s1">&#39;sleep_duration&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">navy</span><span class="p">,</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="s1">&#39;distance&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">green</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="s1">&#39;active_minutes&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">purple</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="s1">&#39;floors_climbed&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">saddlebrown</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="s1">&#39;elevation&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">brown</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="s1">&#39;activity_calories&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">orange</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="s1">&#39;calories_bmr&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">orange</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="s1">&#39;minutes_sedentary&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="s1">&#39;minutes_lightly_active&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightgreen</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="s1">&#39;minutes_fairly_active&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">yellow</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="s1">&#39;calories_in&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">red</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="s1">&#39;water&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">blue</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="p">}</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">chart_color</span> <span class="o">=</span> <span class="n">chart_colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">vital_type</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">blueviolet</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">chart</span> <span class="o">=</span> <span class="n">HorizontalLineChart</span><span class="p">()</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">chart</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">450</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">chart</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">170</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">chart</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">25</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">chart</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="c1"># Set data</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">if</span> <span class="n">values</span><span class="p">:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">]</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">categoryAxis</span><span class="o">.</span><span class="n">categoryNames</span> <span class="o">=</span> <span class="n">dates</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">valueAxis</span><span class="o">.</span><span class="n">valueMin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.9</span> <span class="k">if</span> <span class="n">values</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">valueAxis</span><span class="o">.</span><span class="n">valueMax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.1</span> <span class="k">if</span> <span class="n">values</span> <span class="k">else</span> <span class="mi">100</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="c1"># Ensure min and max are float</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">valueAxis</span><span class="o">.</span><span class="n">valueMin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">valueAxis</span><span class="o">.</span><span class="n">valueMin</span><span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">valueAxis</span><span class="o">.</span><span class="n">valueMax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">valueAxis</span><span class="o">.</span><span class="n">valueMax</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="c1"># Style the chart</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strokeWidth</span> <span class="o">=</span> <span class="mf">2.5</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strokeColor</span> <span class="o">=</span> <span class="n">chart_color</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="c1"># Enhance chart appearance</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">categoryAxis</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">30</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">categoryAxis</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">boxAnchor</span> <span class="o">=</span> <span class="s1">&#39;ne&#39;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">categoryAxis</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">fontName</span> <span class="o">=</span> <span class="s1">&#39;Helvetica&#39;</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">categoryAxis</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">fontSize</span> <span class="o">=</span> <span class="mi">7</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">valueAxis</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">fontName</span> <span class="o">=</span> <span class="s1">&#39;Helvetica&#39;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">valueAxis</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">fontSize</span> <span class="o">=</span> <span class="mi">8</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="c1"># Configurazione griglia</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">categoryAxis</span><span class="o">.</span><span class="n">strokeWidth</span> <span class="o">=</span> <span class="mf">0.5</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">valueAxis</span><span class="o">.</span><span class="n">strokeWidth</span> <span class="o">=</span> <span class="mf">0.5</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">valueAxis</span><span class="o">.</span><span class="n">gridStrokeWidth</span> <span class="o">=</span> <span class="mf">0.25</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">chart</span><span class="o">.</span><span class="n">valueAxis</span><span class="o">.</span><span class="n">gridStrokeColor</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightgrey</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="c1"># Add title</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">vital_name</span> <span class="o">=</span> <span class="n">vital_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vital_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">period_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">drawing</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">chart</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="c1"># Add legend with title</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">legend</span> <span class="o">=</span> <span class="n">Legend</span><span class="p">()</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">legend</span><span class="o">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">legend</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">25</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">legend</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">200</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">legend</span><span class="o">.</span><span class="n">columnMaximum</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">legend</span><span class="o">.</span><span class="n">fontName</span> <span class="o">=</span> <span class="s1">&#39;Helvetica-Bold&#39;</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="n">legend</span><span class="o">.</span><span class="n">fontSize</span> <span class="o">=</span> <span class="mi">9</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">legend</span><span class="o">.</span><span class="n">dxTextSpace</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="n">legend</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="n">legend</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">legend</span><span class="o">.</span><span class="n">deltay</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="n">legend</span><span class="o">.</span><span class="n">colorNamePairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">chart_color</span><span class="p">,</span> <span class="n">title</span><span class="p">)]</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="n">drawing</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">legend</span><span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="k">return</span> <span class="n">drawing</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.reports.generate_specific_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_specific_report</span><span class="p">(</span><span class="n">patient</span><span class="p">,</span> <span class="n">doctor</span><span class="p">,</span> <span class="n">selected_notes</span><span class="p">,</span> <span class="n">selected_vital_types</span><span class="p">,</span> <span class="n">selected_charts</span><span class="p">,</span> <span class="n">selected_observations</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#app.reports.generate_specific_report" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate a customized PDF report with only selected patient data.
This function creates a professionally formatted PDF report containing only the
specifically selected vital signs, observations, and clinical notes for a patient.
The report includes patient and doctor information, optional summary text, selected
clinical notes, vital sign charts for selected time periods, and relevant medical
observations. The PDF is styled with a modern, clean design optimized for medical
professionals.
Args:
    patient (Patient): Patient object containing demographic and identification information.
    doctor (Doctor): Doctor object representing the healthcare professional generating the report.
    selected_notes (list): List of selected Note objects to include in the report.
    selected_vital_types (list): List of VitalSignType enum values for which charts should be generated.
    selected_charts (dict): Dictionary mapping vital type values to lists of time period codes
                          (e.g. {'heart_rate': ['7d', '1m']}). Controls which charts are included.
    selected_observations (list): List of VitalObservation objects to include in the report.
    summary (str, optional): Optional summary text provided by the doctor. This text appears
                           at the beginning of the report but is not saved to the database.
    language (str, optional): Optional language code override ('it' or 'en').
                            If not provided, uses the current Flask-Babel locale.
Returns:
    BytesIO: PDF file as a binary stream ready to be served to the client or saved.
            The PDF follows medical documentation best practices and includes
            proper headers, footers, and organizational structure.</p>


            <details class="quote">
              <summary>Source code in <code>app/reports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_specific_report</span><span class="p">(</span><span class="n">patient</span><span class="p">,</span> <span class="n">doctor</span><span class="p">,</span> <span class="n">selected_notes</span><span class="p">,</span> <span class="n">selected_vital_types</span><span class="p">,</span> <span class="n">selected_charts</span><span class="p">,</span> <span class="n">selected_observations</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    Generate a customized PDF report with only selected patient data.</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    This function creates a professionally formatted PDF report containing only the</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    specifically selected vital signs, observations, and clinical notes for a patient.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    The report includes patient and doctor information, optional summary text, selected</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    clinical notes, vital sign charts for selected time periods, and relevant medical</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">    observations. The PDF is styled with a modern, clean design optimized for medical</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    professionals.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        patient (Patient): Patient object containing demographic and identification information.</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        doctor (Doctor): Doctor object representing the healthcare professional generating the report.</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        selected_notes (list): List of selected Note objects to include in the report.</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        selected_vital_types (list): List of VitalSignType enum values for which charts should be generated.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        selected_charts (dict): Dictionary mapping vital type values to lists of time period codes</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">                              (e.g. {&#39;heart_rate&#39;: [&#39;7d&#39;, &#39;1m&#39;]}). Controls which charts are included.</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        selected_observations (list): List of VitalObservation objects to include in the report.</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">        summary (str, optional): Optional summary text provided by the doctor. This text appears</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">                               at the beginning of the report but is not saved to the database.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        language (str, optional): Optional language code override (&#39;it&#39; or &#39;en&#39;).</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">                                If not provided, uses the current Flask-Babel locale.</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        BytesIO: PDF file as a binary stream ready to be served to the client or saved.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">                The PDF follows medical documentation best practices and includes</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">                proper headers, footers, and organizational structure.</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="c1"># Set language if provided (Flask-Babel handles this automatically if None)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="k">if</span> <span class="n">language</span><span class="p">:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="c1"># Qui potrebbe essere necessario un meccanismo per impostare la lingua temporaneamente</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="k">pass</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="c1"># Create the PDF document</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="n">doc</span> <span class="o">=</span> <span class="n">SimpleDocTemplate</span><span class="p">(</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="n">buffer</span><span class="p">,</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="n">pagesize</span><span class="o">=</span><span class="n">letter</span><span class="p">,</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">rightMargin</span><span class="o">=</span><span class="mi">54</span><span class="p">,</span>  <span class="c1"># 3/4 inch margins for more modern look</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="n">leftMargin</span><span class="o">=</span><span class="mi">54</span><span class="p">,</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="n">topMargin</span><span class="o">=</span><span class="mi">54</span><span class="p">,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="n">bottomMargin</span><span class="o">=</span><span class="mi">54</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="c1"># Get styles</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="n">styles</span> <span class="o">=</span> <span class="n">getSampleStyleSheet</span><span class="p">()</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="c1"># Add custom styles for modern look</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ParagraphStyle</span><span class="p">(</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Heading1Center&#39;</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading1&#39;</span><span class="p">],</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="n">alignment</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># 0=left, 1=center, 2=right</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="n">fontName</span><span class="o">=</span><span class="s1">&#39;Helvetica-Bold&#39;</span><span class="p">,</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="n">fontSize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="n">spaceAfter</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="n">textColor</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">darkblue</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="p">))</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ParagraphStyle</span><span class="p">(</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Heading2Modern&#39;</span><span class="p">,</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading2&#39;</span><span class="p">],</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="n">fontName</span><span class="o">=</span><span class="s1">&#39;Helvetica-Bold&#39;</span><span class="p">,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="n">fontSize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="n">spaceAfter</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="n">textColor</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">darkblue</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="p">))</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ParagraphStyle</span><span class="p">(</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Heading3Modern&#39;</span><span class="p">,</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading3&#39;</span><span class="p">],</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="n">fontName</span><span class="o">=</span><span class="s1">&#39;Helvetica-Bold&#39;</span><span class="p">,</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="n">fontSize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">spaceAfter</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="n">textColor</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">navy</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="p">))</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ParagraphStyle</span><span class="p">(</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Normal-Center&#39;</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">],</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="n">alignment</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="n">fontSize</span><span class="o">=</span><span class="mi">10</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="p">))</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ParagraphStyle</span><span class="p">(</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Normal-Bold&#39;</span><span class="p">,</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">],</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="n">fontName</span><span class="o">=</span><span class="s1">&#39;Helvetica-Bold&#39;</span><span class="p">,</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="n">fontSize</span><span class="o">=</span><span class="mi">10</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="p">))</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ParagraphStyle</span><span class="p">(</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Normal-Italic&#39;</span><span class="p">,</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">],</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="n">fontName</span><span class="o">=</span><span class="s1">&#39;Helvetica-Oblique&#39;</span><span class="p">,</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="n">fontSize</span><span class="o">=</span><span class="mi">10</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="p">))</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ParagraphStyle</span><span class="p">(</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ObservationTitle&#39;</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal-Bold&#39;</span><span class="p">],</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="n">fontSize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">textColor</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">darkblue</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="p">))</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ParagraphStyle</span><span class="p">(</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ObservationContent&#39;</span><span class="p">,</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">],</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">fontSize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">leftIndent</span><span class="o">=</span><span class="mi">15</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="p">))</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ParagraphStyle</span><span class="p">(</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Footer&#39;</span><span class="p">,</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">],</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="n">fontSize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="n">textColor</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">grey</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="p">))</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="c1"># Build content</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="n">content</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="c1"># Report Header with modern style</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Specific Report&#39;</span><span class="p">),</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading1Center&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="c1"># Date of report</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Generated on&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y %H:%M&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal-Center&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="c1"># Define a modern table style with rounded corners using background colors</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="n">modern_table_style</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">lavender</span><span class="p">),</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="p">(</span><span class="s1">&#39;TEXTCOLOR&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">),</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="p">(</span><span class="s1">&#39;ALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;RIGHT&#39;</span><span class="p">),</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="p">(</span><span class="s1">&#39;ALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;LEFT&#39;</span><span class="p">),</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">),</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>        <span class="p">(</span><span class="s1">&#39;FONTSIZE&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="p">),</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="p">(</span><span class="s1">&#39;BOTTOMPADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">8</span><span class="p">),</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="p">(</span><span class="s1">&#39;TOPPADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">8</span><span class="p">),</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="p">(</span><span class="s1">&#39;VALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;MIDDLE&#39;</span><span class="p">),</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="p">(</span><span class="s1">&#39;BOX&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">grey</span><span class="p">),</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">white</span><span class="p">),</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="p">(</span><span class="s1">&#39;LINEBELOW&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">grey</span><span class="p">),</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="p">(</span><span class="s1">&#39;GRID&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">grey</span><span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="p">]</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>    <span class="c1"># Patient Information with modern styling</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Patient Information&#39;</span><span class="p">),</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading2Modern&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="n">patient_data</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">patient</span><span class="o">.</span><span class="n">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">patient</span><span class="o">.</span><span class="n">last_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Date of Birth&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="n">patient</span><span class="o">.</span><span class="n">date_of_birth</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y&#39;</span><span class="p">)],</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Gender&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="n">patient</span><span class="o">.</span><span class="n">gender</span> <span class="ow">or</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Not specified&#39;</span><span class="p">)],</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Contact&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="n">patient</span><span class="o">.</span><span class="n">contact_number</span><span class="p">],</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Email&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="n">patient</span><span class="o">.</span><span class="n">email</span> <span class="ow">or</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Not provided&#39;</span><span class="p">)]</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="p">]</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="n">patient_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">patient_data</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">inch</span><span class="p">])</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="n">patient_table</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">TableStyle</span><span class="p">(</span><span class="n">modern_table_style</span><span class="p">))</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patient_table</span><span class="p">)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>    <span class="c1"># Doctor Information</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Attending Physician&#39;</span><span class="p">),</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading2Modern&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="n">doctor_data</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Dr. </span><span class="si">{</span><span class="n">doctor</span><span class="o">.</span><span class="n">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">doctor</span><span class="o">.</span><span class="n">last_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Specialty&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="n">doctor</span><span class="o">.</span><span class="n">specialty</span> <span class="ow">or</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;General Practice&#39;</span><span class="p">)],</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Email&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="n">doctor</span><span class="o">.</span><span class="n">email</span><span class="p">]</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="p">]</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="n">doctor_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">doctor_data</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">inch</span><span class="p">])</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="n">doctor_table</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">TableStyle</span><span class="p">(</span><span class="n">modern_table_style</span><span class="p">))</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doctor_table</span><span class="p">)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">36</span><span class="p">))</span> <span class="c1"># More spacing for clearer separation</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="c1"># Summary section (if provided)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="k">if</span> <span class="n">summary</span><span class="p">:</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Summary&#39;</span><span class="p">),</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading2Modern&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="c1"># Selected notes section</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="k">if</span> <span class="n">selected_notes</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Clinical Notes&#39;</span><span class="p">),</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading2Modern&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">note</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selected_notes</span><span class="p">):</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="n">date_str</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y %H:%M&#39;</span><span class="p">)</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="n">doctor_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Dr. </span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">last_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;b&gt;</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">doctor_name</span><span class="si">}</span><span class="s2">&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal-Bold&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;ObservationContent&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>            <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="c1"># Add a divider between notes except for the last one</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_notes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>                <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>                <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;&lt;hr width=&#39;100%&#39; color=&#39;#e0e0e0&#39; /&gt;&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal-Center&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="c1"># Group observations by vital type for later use</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="n">obs_by_type</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="k">if</span> <span class="n">selected_observations</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">selected_observations</span><span class="p">:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>            <span class="n">vital_type</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">vital_type</span><span class="o">.</span><span class="n">value</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="k">if</span> <span class="n">vital_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obs_by_type</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>                <span class="n">obs_by_type</span><span class="p">[</span><span class="n">vital_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="n">obs_by_type</span><span class="p">[</span><span class="n">vital_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="c1"># Selected vital signs section with integrated observations</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="k">if</span> <span class="n">selected_vital_types</span> <span class="ow">and</span> <span class="n">selected_charts</span><span class="p">:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Vital Signs&#39;</span><span class="p">),</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading2Modern&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.health_platforms</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_vitals_data</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="c1"># Define colors for each vital type</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="n">vital_colors</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="s1">&#39;heart_rate&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">red</span><span class="p">,</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="s1">&#39;steps&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">teal</span><span class="p">,</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="s1">&#39;calories&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">orange</span><span class="p">,</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="s1">&#39;distance&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">green</span><span class="p">,</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="s1">&#39;active_minutes&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">purple</span><span class="p">,</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="s1">&#39;sleep_duration&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">navy</span><span class="p">,</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="s1">&#39;floors_climbed&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">saddlebrown</span><span class="p">,</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="s1">&#39;elevation&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">brown</span><span class="p">,</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">green</span><span class="p">,</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="s1">&#39;activity_calories&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">orange</span><span class="p">,</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="s1">&#39;calories_bmr&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">orange</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="s1">&#39;minutes_sedentary&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="s1">&#39;minutes_lightly_active&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightgreen</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="s1">&#39;minutes_fairly_active&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">yellow</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="s1">&#39;calories_in&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">red</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="s1">&#39;water&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">blue</span><span class="p">,</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="s1">&#39;breathing_rate&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">cyan</span><span class="p">,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="s1">&#39;oxygen_saturation&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">blue</span><span class="p">,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="s1">&#39;temperature_core&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">orange</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="s1">&#39;temperature_skin&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">orange</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="p">}</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="k">for</span> <span class="n">vital_type</span> <span class="ow">in</span> <span class="n">selected_vital_types</span><span class="p">:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="n">vital_type_value</span> <span class="o">=</span> <span class="n">vital_type</span><span class="o">.</span><span class="n">value</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>            <span class="n">color</span> <span class="o">=</span> <span class="n">vital_colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">vital_type_value</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">darkblue</span><span class="p">)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="c1"># Create a paragraph style with the specific vital color</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ParagraphStyle</span><span class="p">(</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>                <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Heading3-</span><span class="si">{</span><span class="n">vital_type_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading3Modern&#39;</span><span class="p">],</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                <span class="n">textColor</span><span class="o">=</span><span class="n">color</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="p">))</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vital_type_value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Heading3-</span><span class="si">{</span><span class="n">vital_type_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="n">has_data</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="c1"># Check if this vital type has selected charts</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="k">if</span> <span class="n">vital_type_value</span> <span class="ow">in</span> <span class="n">selected_charts</span> <span class="ow">and</span> <span class="n">selected_charts</span><span class="p">[</span><span class="n">vital_type_value</span><span class="p">]:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                <span class="n">periods</span> <span class="o">=</span> <span class="n">selected_charts</span><span class="p">[</span><span class="n">vital_type_value</span><span class="p">]</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                <span class="k">for</span> <span class="n">period_days</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">:</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>                    <span class="c1"># Get period display name</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>                    <span class="k">if</span> <span class="n">period_days</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                        <span class="n">period_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;1 Day&#39;</span><span class="p">)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>                    <span class="k">elif</span> <span class="n">period_days</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>                        <span class="n">period_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;7 Days&#39;</span><span class="p">)</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>                    <span class="k">elif</span> <span class="n">period_days</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>                        <span class="n">period_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;1 Month&#39;</span><span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>                    <span class="k">elif</span> <span class="n">period_days</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>                        <span class="n">period_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;3 Months&#39;</span><span class="p">)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                        <span class="n">period_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period_days</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;days&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                    <span class="c1"># Calculate date range</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>                    <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                    <span class="n">start_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">period_days</span><span class="p">)</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                    <span class="c1"># Display date range in an elegant way</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                    <span class="n">date_range_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>                    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;i&gt;</span><span class="si">{</span><span class="n">date_range_text</span><span class="si">}</span><span class="s2">&lt;/i&gt;&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal-Italic&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>                        <span class="c1"># Try to get data from health platform</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>                        <span class="n">vitals_data</span> <span class="o">=</span> <span class="n">get_vitals_data</span><span class="p">(</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                            <span class="n">patient</span><span class="p">,</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>                            <span class="n">vital_type_value</span><span class="p">,</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>                            <span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>                            <span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                        <span class="p">)</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>                        <span class="k">if</span> <span class="n">vitals_data</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">vitals_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>                            <span class="n">has_data</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>                            <span class="c1"># Create chart</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>                            <span class="n">chart</span> <span class="o">=</span> <span class="n">create_vital_chart</span><span class="p">(</span><span class="n">vitals_data</span><span class="p">,</span> <span class="n">period_name</span><span class="p">,</span> <span class="n">vital_type_value</span><span class="p">)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>                            <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="p">)</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                            <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                            <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;No vital data available for this period.&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal-Italic&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                            <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting data for </span><span class="si">{</span><span class="n">vital_type_value</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;No vital data available for this period.&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal-Italic&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>                        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>                <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;No vital data available for this period.&#39;</span><span class="p">),</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal-Italic&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>            <span class="c1"># Add observations for this vital type immediately after its charts</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>            <span class="k">if</span> <span class="n">vital_type_value</span> <span class="ow">in</span> <span class="n">obs_by_type</span> <span class="ow">and</span> <span class="n">obs_by_type</span><span class="p">[</span><span class="n">vital_type_value</span><span class="p">]:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>                <span class="k">if</span> <span class="n">has_data</span><span class="p">:</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>                    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                <span class="c1"># Add a subheading for observations</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Observations&#39;</span><span class="p">),</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;ObservationTitle&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                <span class="n">obs_list</span> <span class="o">=</span> <span class="n">obs_by_type</span><span class="p">[</span><span class="n">vital_type_value</span><span class="p">]</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_list</span><span class="p">):</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                    <span class="c1"># Format the date range</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                    <span class="n">date_range</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obs</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">obs</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>                    <span class="n">doctor_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Dr. </span><span class="si">{</span><span class="n">obs</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">obs</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">last_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>                    <span class="c1"># Use a box with soft background for each observation</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                    <span class="n">obs_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([[</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;b&gt;</span><span class="si">{</span><span class="n">date_range</span><span class="si">}</span><span class="s2">&lt;/b&gt; - </span><span class="si">{</span><span class="n">doctor_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal-Bold&#39;</span><span class="p">])],</span> 
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>                                       <span class="p">[</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">])]],</span> 
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                                      <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">5.5</span><span class="o">*</span><span class="n">inch</span><span class="p">])</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>                    <span class="n">obs_table</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">TableStyle</span><span class="p">([</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>                        <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">lavender</span><span class="p">),</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>                        <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">white</span><span class="p">),</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>                        <span class="p">(</span><span class="s1">&#39;TEXTCOLOR&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">),</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                        <span class="p">(</span><span class="s1">&#39;ALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;LEFT&#39;</span><span class="p">),</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>                        <span class="p">(</span><span class="s1">&#39;VALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;MIDDLE&#39;</span><span class="p">),</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>                        <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">),</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                        <span class="p">(</span><span class="s1">&#39;FONTSIZE&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="p">),</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                        <span class="p">(</span><span class="s1">&#39;BOTTOMPADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">8</span><span class="p">),</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>                        <span class="p">(</span><span class="s1">&#39;TOPPADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">8</span><span class="p">),</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                        <span class="p">(</span><span class="s1">&#39;LEFTPADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">12</span><span class="p">),</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                        <span class="p">(</span><span class="s1">&#39;RIGHTPADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">12</span><span class="p">),</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>                        <span class="p">(</span><span class="s1">&#39;BOX&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">grey</span><span class="p">),</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>                        <span class="p">(</span><span class="s1">&#39;GRID&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightgrey</span><span class="p">)</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                    <span class="p">]))</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs_table</span><span class="p">)</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                    <span class="c1"># Add a divider between observations except for the last one</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>                        <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>                <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>            <span class="c1"># Add spacing between different vital types</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>    <span class="c1"># Footer with page numbers</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_page_number</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">        Add page numbers and footer to each page of the PDF report.</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        This function is called by ReportLab&#39;s document build process for each page</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        during PDF generation. It adds a thin grey line above the footer area,</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">        page numbers in the format &#39;Page X / Y&#39; in the bottom right corner,</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">        and a timestamp with the application name in the bottom left corner.</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">            canvas (Canvas): ReportLab canvas object for drawing on the PDF page</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">            doc (SimpleDocTemplate): The PDF document being built, containing page information</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">                                    such as current page number and page size</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">            None: The function modifies the canvas in-place</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="n">canvas</span><span class="o">.</span><span class="n">saveState</span><span class="p">()</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="n">canvas</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s1">&#39;Helvetica&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="n">canvas</span><span class="o">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">grey</span><span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="c1"># Draw a thin line above the footer</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="n">page_width</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">pagesize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="n">canvas</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">page_width</span><span class="o">-</span><span class="mi">54</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="c1"># Add page number</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="n">page_num</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Page&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">page</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="n">canvas</span><span class="o">.</span><span class="n">drawRightString</span><span class="p">(</span><span class="n">page_width</span><span class="o">-</span><span class="mi">54</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">page_num</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="c1"># Add timestamp</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;VitaLink - </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="n">canvas</span><span class="o">.</span><span class="n">drawString</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="n">canvas</span><span class="o">.</span><span class="n">restoreState</span><span class="p">()</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="c1"># Build PDF with page numbers</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="n">doc</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">onFirstPage</span><span class="o">=</span><span class="n">add_page_number</span><span class="p">,</span> <span class="n">onLaterPages</span><span class="o">=</span><span class="n">add_page_number</span><span class="p">)</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="k">return</span> <span class="n">buffer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copiato", "clipboard.copy": "Copia", "search.result.more.one": "1 altro in questa pagina", "search.result.more.other": "# altri in questa pagina", "search.result.none": "Nessun documento trovato", "search.result.one": "1 documento trovato", "search.result.other": "# documenti trovati", "search.result.placeholder": "Scrivi per iniziare a cercare", "search.result.term.missing": "Non presente", "select.version": "Seleziona la versione"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>